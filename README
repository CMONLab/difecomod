# difecomod: Differential Co-occurrence Analysis for Ecological Modules

<!-- badges: start -->
<!-- badges: end -->

**difecomod** implements differential co-occurrence analysis methodology for detecting ecosystem blocks or modules that change between host conditions in microbiome data. This approach is particularly useful for understanding how microbial community interactions are altered by disease states, treatments, or environmental changes.

## Overview

Given the modularity of microbial network interactions, we hypothesized that different ecosystem blocks or modules coexist within the microbiota and that changes in the host environment (e.g., disease conditions) might favor certain blocks of interacting species over others. 

The methodology consists of several key steps:

1. **Data Processing**: Convert relative abundance data to binary occurrence matrices
2. **Co-occurrence Calculation**: Compute frequencies of taxa co-occurrence in each condition
3. **Statistical Testing**: Use null random and permutation models for co-occurrences to assess significance
4. **Network Construction**: Build microbial networks of significant differential co-occurrences
5. **Higher-Order Interactions**: Analyze three-taxa co-occurrences in data

## Installation

You can install the development version of difecomod from GitHub:

```r
# Install devtools if not already installed
if (!require("devtools")) install.packages("devtools")

# Install difecomod (dependencies will be installed automatically)
devtools::install_github("CMONLab/difecomod")
```

**Note**: All required dependencies (igraph, network, pheatmap, ggplot2, zCompositions, RColorBrewer, and others) will be automatically installed. For the vignette examples, you may also need to install: `SummarizedExperiment` and `tictoc`.

## Getting Started

For a comprehensive tutorial with real microbiome data examples, see the package vignette:

```r
library(difecomod)

# View the introductory vignette
vignette("introduction_difecomod", package = "difecomod")
```

The vignette demonstrates:
- Loading and processing microbiome data
- Converting abundance to occurrence matrices
- Running statistical tests (random and permutation models)
- Constructing differential co-occurrence networks
- Analyzing higher-order interactions (triplets)
- Visualizing results with heatmaps and network plots

## Workflow

The typical analysis workflow includes:

1. **Core Taxa Extraction**: Filter taxa based on prevalence thresholds (e.g., present in >10% of samples)
2. **Occurrence Matrix Conversion**: Convert abundance data to binary occurrence matrices using detection thresholds
3. **Co-occurrence Computation**: Calculate pairwise co-occurrence frequencies for each condition
4. **Null Model Generation**: Create random and permutation-based null distributions
5. **Statistical Thresholds**: Compute significance thresholds from both null models
6. **Network Construction**: Identify differential co-occurrences that exceed both statistical criteria
7. **Higher-Order Analysis**: Analyze three-way interactions within network triangles
8. **Visualization**: Generate network plots and abundance heatmaps

## Documentation

- **Vignette**: Comprehensive tutorial with real microbiome data examples (`vignette("introduction_difecomod", package = "difecomod")`)
- **Function Help**: Detailed documentation for all exported functions (`?function_name`)
- **GitHub Repository**: Extended examples and source code at [github.com/CMONLab/difecomod](https://github.com/CMONLab/difecomod)

## Best Practices

When working with real microbiome data:

1. **Sample Size**: Ensure adequate sample sizes (>20 samples per condition recommended)
2. **Taxa Filtering**: Use appropriate prevalence thresholds to extract core genera (10% recommended)
3. **Abundance Threshold**: Set meaningful detection thresholds (0.01-0.1% relative abundance)
4. **Permutation/Reshuffling Number**: Use sufficient number of permutations/reshufflings for robust statistical inference (â‰¥5000)
5. **Biological Interpretation**: Validate significant interactions using biological knowledge and literature

## Contributing

We welcome contributions! Please:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit changes (`git commit -m 'Add amazing feature'`)
4. Push to branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## Reference

If you use difecomod in your research, please cite:

**Differential Co-occurrence Analysis: a Method to Extract Ecological Modules from Clinical Microbiome Data**. J. Iacovacci, N. Cannon, J.A. McCulloch, T. Rancati, G. Trinchieri (2025).

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Contact

- **Author**: Jacopo Iacovacci
- **Email**: jacopo.iacovacci@istitutotumori.mi.it
- **Issues**: [GitHub Issues](https://github.com/CMONLab/difecomod/issues)